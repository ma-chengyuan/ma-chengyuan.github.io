<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"alan20210202.github.io","root":"/","images":"/images","scheme":"Mist","version":"8.2.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":true,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}};
  </script>
<meta name="description" content="不务正业高中生一枚">
<meta property="og:type" content="website">
<meta property="og:title" content="Chengyuan Ma&#39;s Blog">
<meta property="og:url" content="https://alan20210202.github.io/index.html">
<meta property="og:site_name" content="Chengyuan Ma&#39;s Blog">
<meta property="og:description" content="不务正业高中生一枚">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Chengyuan Ma">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://alan20210202.github.io/">


<script data-pjax class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css" integrity="sha512-tN7Ec6zAFaVSG3TpNAKtk4DOHNpSwKHxxrsiw4GHKESGPs5njn/0sMCUMl2svV4wo4BK/rCP7juYz+zx+l6oeQ==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/plugins/line-numbers/prism-line-numbers.min.css" integrity="sha512-cbQXwDFK7lj2Fqfkuxbo5iD1dSbLlJGXGpfTDqbggqjHJeyzx88I3rfwjS38WJag/ihH7lzuGlGHpDBymLirZQ==" crossorigin="anonymous" />
<title>Chengyuan Ma's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-65HSG5NCY6"></script>
    <script data-pjax>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-65HSG5NCY6');
      }
    </script>




  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Chengyuan Ma's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
        <li class="menu-item menu-item-pagedewarp"><a href="/dewarp/" rel="section"><i class="fa fa-sticky-note fa-fw"></i>PageDewarp</a></li>
        <li class="menu-item menu-item-english"><a href="/english/" rel="section"><i class="fa fa-globe-americas fa-fw"></i>English</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Chengyuan Ma"
      src="/avatar.png">
  <p class="site-author-name" itemprop="name">Chengyuan Ma</p>
  <div class="site-description" itemprop="description">不务正业高中生一枚</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">94</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      友情链接
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://kalasearch.cn/" title="https:&#x2F;&#x2F;kalasearch.cn&#x2F;" rel="noopener" target="_blank">卡拉搜索</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://alan20210202.github.io/2021/07/25/%E9%A9%AC%E8%BE%BE%E5%BB%BA%E6%A8%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/avatar.png">
      <meta itemprop="name" content="Chengyuan Ma">
      <meta itemprop="description" content="不务正业高中生一枚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chengyuan Ma's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/25/%E9%A9%AC%E8%BE%BE%E5%BB%BA%E6%A8%A1/" class="post-title-link" itemprop="url">VEX 393 马达电流模型</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-25 03:11:41" itemprop="dateCreated datePublished" datetime="2021-07-25T03:11:41-04:00">2021-07-25</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-12-15 03:02:16" itemprop="dateModified" datetime="2018-12-15T03:02:16-05:00">2018-12-15</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="电路图">电路图</h1>
<p><img src="http://ovzrr9kke.bkt.clouddn.com/18-9-19/85128984.jpg" /></p>
<p>绿色箭头为PWM开段电流方向，红色为闭段电流方向。</p>
<h1 id="模型">模型</h1>
<h2 id="符号定义">符号定义</h2>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">符号</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;"><span class="math inline">\(f_{\text{pwm}} \approx 1250\text{Hz}\)</span></td>
<td>PWM频率</td>
</tr>
<tr class="even">
<td style="text-align: right;"><span class="math inline">\(t_{\text{pwm}} \approx 1 / f_{\text{pwm}}\)</span></td>
<td>PWM周期</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><span class="math inline">\(t_{\text{on}}\)</span></td>
<td>PWM高电位时间</td>
</tr>
<tr class="even">
<td style="text-align: right;"><span class="math inline">\(t_{\text{off}}\)</span></td>
<td>PWM低电位时间</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><span class="math inline">\(I(t)\)</span></td>
<td>电流（随时间变化）</td>
</tr>
<tr class="even">
<td style="text-align: right;"><span class="math inline">\(I_0\)</span></td>
<td>PWM周期开始时的电流</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><span class="math inline">\(I_{\text{max}}\)</span></td>
<td>PWM峰值电流</td>
</tr>
<tr class="even">
<td style="text-align: right;"><span class="math inline">\(I_{\text{final}}\)</span></td>
<td>PWM周期结束时的电流</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><span class="math inline">\(U_\text{b} \approx 7.4\text V\)</span></td>
<td>电池电压</td>
</tr>
<tr class="even">
<td style="text-align: right;"><span class="math inline">\(U_\text{bemf}\)</span></td>
<td>反电动势</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><span class="math inline">\(U_\text L\)</span></td>
<td>电感电压</td>
</tr>
<tr class="even">
<td style="text-align: right;"><span class="math inline">\(U_\text D \approx 0.75 \text V\)</span></td>
<td>二极管压降</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><span class="math inline">\(L \approx 6.5\times 10^{-4}\text H\)</span></td>
<td>电感</td>
</tr>
<tr class="even">
<td style="text-align: right;"><span class="math inline">\(R \approx 1.609\Omega\)</span></td>
<td>马达内阻</td>
</tr>
<tr class="odd">
<td style="text-align: right;"><span class="math inline">\(R_\text s \approx 0.28\Omega\)</span></td>
<td>系统内阻</td>
</tr>
</tbody>
</table>
<p><strong>部分参数可以自行测定，测定方法见文末。</strong></p>
<h2 id="开段分析">开段分析</h2>
<p>首先，由基尔霍夫定律和欧姆定律，可得： <span class="math display">\[
U_\text b - I(t)(R+R_\text s) - U_\text L - U_\text {bemf} = 0
\]</span> 对上式进行整理，并结合电感电压公式： <span class="math display">\[
U_\text b = L\frac{dI(t)}{dt} + I(t)(R + R_\text s) + U_\text {bemf}
\]</span> 我们把它看做一个关于<span class="math inline">\(I\)</span>的线性微分方程，初始条件为<span class="math inline">\(I(0) = I_0\)</span>解得： <span class="math display">\[
I(t) = e^{-\frac{t(R + R_\text s)}{L}} \left( I_0 - \frac{U_\text b - U_\text {bemf}}{R + R_\text s}\right) + \frac{U_\text b - U_\text {bemf}}{R + R_\text s}
\]</span> 我们知道电流在高电压段逐步变大，因此<span class="math inline">\(I_\text{max} = I(t_\text{on})\)</span>，即： <span class="math display">\[
I_\text{max} = e^{-\frac{t_\text{on}(R + R_\text s)}{L}} \left( I_0 - \frac{U_\text b - U_\text {bemf}}{R + R_\text s}\right) + \frac{U_\text b - U_\text {bemf}}{R + R_\text s}
\]</span> 出于简化式子的需要，令 <span class="math display">\[
\begin{aligned}
c_\text{on} &amp;= -\frac{t_\text{on}(R + R_\text s)}{L} \\
e_\text{on} &amp;= e^{c_\text{on}} = e^{-\frac{t_\text{on}(R + R_\text s)}{L}} \\
I_\text{on} &amp;= \frac{U_\text b - U_\text {bemf}}{R + R_\text s}
\end{aligned}
\]</span> 注意到<span class="math inline">\(I_\text{on}\)</span>为<span class="math inline">\(\frac{dI(t)}{dt} \to 0\)</span>时的电流，因此也称作<strong>稳态电流</strong>。</p>
<p>整理得到： <span class="math display">\[
I_\text{max} = e_\text{on}I_0 + (1 - e_\text{on})I_\text{on}
\]</span> 为了之后平均电流的计算需要我们顺便计算一波<span class="math inline">\(I(t)\)</span>的积分： <span class="math display">\[
\int^{t_\text{on}}_0 I(t)dt = t_\text{on}\left(I_\text{on} - \frac{(1 - e_\text{on})(I_0 - I_\text{on})}{c_\text{on}}\right)
\]</span></p>
<h2 id="闭段分析">闭段分析</h2>
<p>再次由基尔霍夫定律及欧姆定律，有：</p>
<p><span class="math display">\[
I(t)R + U_\text L + U_\text {bemf} + U_\text D = 0
\]</span> 同样整理： <span class="math display">\[
I(t)R + L \frac{dI(t)}{dt}+ U_\text {bemf} + U_\text D = 0
\]</span> 以初始条件<span class="math inline">\(I(0) = I_\text{max}\)</span>求解这个微分方程解得： <span class="math display">\[
I(t) = e^{-\frac{tR}{L}}\left(I_\text{max} + \frac{U_\text {bemf} + U_\text D}{R}\right) - \frac{U_\text {bemf} + U_\text D}{R}
\]</span> 类似地： <span class="math display">\[
I_\text{final} = e^{-\frac{t_\text{off}R}{L}}\left(I_\text{max} + \frac{U_\text {bemf} + U_\text D}{R}\right) - \frac{U_\text {bemf} + U_\text D}{R}
\]</span> 我们也令： <span class="math display">\[
\begin{aligned}
c_\text{off} &amp;= -\frac{t_\text{off}R}{L}\\
e_\text{off} &amp;= e^{c_\text{off}} = e^{-\frac{t_\text{off}R}{L}} \\
I_\text{off} &amp;= - \frac{U_\text {bemf} + U_\text D}{R}
\end{aligned}
\]</span> 可见<span class="math inline">\(I_\text{off}\)</span>也是<span class="math inline">\(\frac{dI(t)}{dt} \to 0\)</span>时的电流，也是稳态电流。</p>
<p>整理得到： <span class="math display">\[
I_\text{final} = e_\text{off}I_\text{max} + (1 - e_\text{off})I_\text{off}
\]</span> 为了后文计算平均电流的需要，我们也计算积分： <span class="math display">\[
\int^{t_\text{off}}_0 I(t)dt = t_\text{off}\left(I_\text{off} - \frac{(1 - e_\text{off})(I_\text{max} - I_\text{off})}{c_\text{off}}\right)
\]</span></p>
<p>注意到以上式子都依赖于<span class="math inline">\(t_\text{on}\)</span>和<span class="math inline">\(t_\text{off}\)</span>，前者就是占空比乘以PWM总周期长度，而后者则有些棘手，因为<span class="math inline">\(t_\text{off} = t_\text{pwm} - t_\text{on}\)</span><strong>并不总是成立</strong>。</p>
<p>接下来的分析有两种情况：</p>
<ol type="1">
<li>连续电流：PWM周期中的电流是连续的，即<span class="math inline">\(I_0 = I_\text{final}\)</span>。</li>
<li>不连续电流：电流在PWM闭段下降至<span class="math inline">\(0\)</span>被二极管截断，即<span class="math inline">\(I_0 = I_\text{final} = 0\)</span>。</li>
</ol>
<p>两种情况需要分类讨论。</p>
<h2 id="连续电流">连续电流</h2>
<p>由<span class="math inline">\(I_0 = I_\text{final}\)</span>，将<span class="math inline">\(I_\text{final}\)</span>展开： <span class="math display">\[
I_0 = I_\text{final} = e_\text{off}(e_\text{on}I_0 + (1 - e_\text{on})I_\text{on}) + (1 - e_\text{off})I_\text{off}
\]</span> 解出<span class="math inline">\(I_0\)</span>： <span class="math display">\[
I_0 = \frac{e_\text{off}(I_\text{off} + (e_\text{on} - 1)I_\text{on}) - I_\text{off}}{e_\text{off}e_\text{on} - 1}
\]</span></p>
<h2 id="不连续电流">不连续电流</h2>
<p>这个时候我们知道<span class="math inline">\(I_0 = I_\text{final} = 0\)</span>，由<span class="math inline">\(I_\text{final}\)</span>的计算式我们可以反解出<span class="math inline">\(t_\text{off}\)</span>： <span class="math display">\[
t_\text{off} = -\frac{L}{R}\ln\left(-\frac{I_\text{off}}{I_\text{max} - I_\text{off}}\right)
\]</span> <strong>从实现上来说，我们先假定<span class="math inline">\(t_\text{off} = t_\text{pwm} - t_\text{on}\)</span>（即假设没有二极管），计算出<span class="math inline">\(I_\text{final}\)</span>，检查它的正负性，来判断电流是否被截断</strong>。</p>
<h2 id="平均电流计算">平均电流计算</h2>
<p>最后，我们结合计算出来的$ t_, t_$，以及开闭段计算出来的两个积分，我们终于可以计算PWM过程中的平均电流： <span class="math display">\[
\overline{I} = f_\text{pwm}\left(t_\text{on}\left(I_\text{on} - \frac{(1 - e_\text{on})(I_0 - I_\text{on})}{c_\text{on}}\right) + t_\text{off}\left(I_\text{off} - \frac{(1 - e_\text{off})(I_\text{max} - I_\text{off})}{c_\text{off}}\right)\right)
\]</span> 这也是我们模型计算的最终结果。</p>
<p><strong>在实际的实现当中需要考虑更多的细节，比如说转速的方向，命令的方向等等……并不总是如以上的公式那么简单，是一项艰苦的体力劳动，具体可以参考In The Zone下的model.c</strong>。</p>
<h2 id="逆向计算">逆向计算</h2>
<p>很多时候我们不仅需要计算马达一定情况下的电流，<strong>更需要计算马达在某一状态下为了达到某一指定电流（扭矩）所需要的指令大小。</strong>例如：</p>
<ol type="1">
<li>计算空载情况下马达到达某一速度所需要的指令值（精确的马达线性化）</li>
<li>把PID的输出看做目标扭矩使用模型再反解出指令。</li>
</ol>
<p>针对这个需求，因为马达曲线直观上总是单调的，因此理论上你总可以根据数学反推推出一个公式，但是由于模型当中牵涉到了分类讨论（电流的连续性），因此较为复杂。利用马达曲线的单调性，二分不失为一个更好的做法。由于指令的范围不大，我们至多只需要二分七八次即可。</p>
<p><strong>注意：模型的计算在Cortex上还是较为耗时间的，实际当中根据当前电压计算一次完整的马达曲线需要4秒左右，优化常数，提高模型计算的效率一直是一个大问题，这也是为什么在实际应用中也许tanh线性化等计算更快的线性化的方法会更好的原因。</strong></p>
<h2 id="结果">结果</h2>
<p>这是真实的速度-指令曲线（空载）：</p>
<p><img src="http://ovzrr9kke.bkt.clouddn.com/18-9-28/12974510.jpg" /></p>
<p>这是使用模型计算的速度-指令曲线：</p>
<p><img src="http://ovzrr9kke.bkt.clouddn.com/18-9-28/17697936.jpg" /></p>
<p>两者几乎一致，说明建模正确。</p>
<h1 id="参数测定">参数测定</h1>
<h2 id="马达内阻">马达内阻</h2>
<p>使用伏安法，我们首先需要测量出马达在<strong>127命令下堵转电流</strong><span class="math inline">\(I_\text{stall}\)</span>，127命令是为了尽可能消除电感的影响（即PWM全开），堵转是为了避免电能转化为机械能消耗掉，则根据开段分析当中的 <span class="math display">\[
U_\text b - I(t)(R+R_\text s) - U_\text L - U_\text {bemf} = 0
\]</span> 此时<span class="math inline">\(U_\text L = U_\text{bemf} = 0, I(t) = I_\text{stall}\)</span>，可反解出 <span class="math display">\[
R = \frac{U_\text b}{I_\text{stall}} - R_\text s
\]</span></p>
<h2 id="反电动势常数">反电动势常数</h2>
<p>我们知道<span class="math inline">\(U_\text{bemf} = K_\text e\omega\)</span>，其中<span class="math inline">\(\omega\)</span>是转速， <span class="math inline">\(K_\text e\)</span>为反电动势常数，为了测定其值，我们测量出马达在<strong>127命令无负载运转电流</strong><span class="math inline">\(I_\text{free}\)</span>和此时的转速<span class="math inline">\(\omega_\text{free}\)</span>（单位不论，但是需要保持统一），由 <span class="math display">\[
U_\text b - I(t)(R+R_\text s) - U_\text L - U_\text {bemf} = 0
\]</span> 此时<span class="math inline">\(U_\text L = 0, I(t) = I_\text{free}\)</span>，解得 <span class="math display">\[
U_\text{bemf} = U_\text b - I_\text{free}(R + R_\text s)
\]</span> 那么 <span class="math display">\[
\begin{aligned}
K_\text e &amp;= \frac{U_\text b - I_\text{free}(R + R_\text s)}{\omega_\text{free}} \\
&amp;= \left(1 - \frac{I_\text{free}}{I_\text{stall}}\right)\frac{U_\text b}{\omega_\text{free}}
\end{aligned}
\]</span></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://alan20210202.github.io/2021/07/25/%E8%AF%84%E8%AE%BA%E6%B5%8B%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/avatar.png">
      <meta itemprop="name" content="Chengyuan Ma">
      <meta itemprop="description" content="不务正业高中生一枚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chengyuan Ma's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/25/%E8%AF%84%E8%AE%BA%E6%B5%8B%E8%AF%95/" class="post-title-link" itemprop="url">评论测试</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-25 03:11:41" itemprop="dateCreated datePublished" datetime="2021-07-25T03:11:41-04:00">2021-07-25</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-07-09 23:51:32" itemprop="dateModified" datetime="2020-07-09T23:51:32-04:00">2020-07-09</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>刚刚启用了博客的评论功能，基于Valine。本帖用于测试（如果后续更换评论系统，则依然使用本帖进行测试）</p>
<p>（真的会有人评论吗？）</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://alan20210202.github.io/2021/07/25/%E9%9D%9E%E4%B8%BB%E6%B5%81LIS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/avatar.png">
      <meta itemprop="name" content="Chengyuan Ma">
      <meta itemprop="description" content="不务正业高中生一枚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chengyuan Ma's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/25/%E9%9D%9E%E4%B8%BB%E6%B5%81LIS/" class="post-title-link" itemprop="url">BIT 解决LIS问题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-25 03:11:41" itemprop="dateCreated datePublished" datetime="2021-07-25T03:11:41-04:00">2021-07-25</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-09-17 07:52:54" itemprop="dateModified" datetime="2018-09-17T07:52:54-04:00">2018-09-17</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>经典的LIS问题不再赘述，利用DP的思想可以做到<span class="math inline">\(O(n^2)\)</span>，利用单调队列优化可以做到<span class="math inline">\(O(n\log n)\)</span>，然而单调队列的做法对于我等蒟蒻来说还是有点复杂的，因此这里介绍一种更初等的，更直接的，更好写的基于BIT的做法。</p>
<p>跳出DP的框架，我们定义<span class="math inline">\(p[x]\)</span>为<strong>以<span class="math inline">\(x\)</span>结尾的LIS的长度</strong>，我们从左到右地扫，同时更新<span class="math inline">\(p[x]\)</span>的值，最后<span class="math inline">\(p\)</span>当中的最大值即为所求的答案。</p>
<p>假设我们扫到数<span class="math inline">\(x\)</span>，很明显它可以接在任何最后一个数小于<span class="math inline">\(x\)</span>的上升子序列的后面，因此我们做如下的更新： <span class="math display">\[
p[x] = \max \begin{cases}
p[x] \\
\max_{1 \le i &lt; x} \{p[i]\} + 1
\end{cases}
\]</span> 我们看到，更新操作需要查询前缀最大值，又因为我们发现<span class="math inline">\(p[x]\)</span>的更新一定是单调不降的，因此得以使用BIT维护（以上条件任意一个不满足都只能使用线段树了），思路较单调队列的直接，之于<span class="math inline">\(x\)</span>范围的问题，离散化一下即可，时间复杂度自然也是<span class="math inline">\(O(n \log n)\)</span>，代码如下：</p>
<pre class="line-numbers"><code class="language-cpp">#include &lt;cstdio&gt;
#include &lt;algorithm&gt; 

using namespace std;
#define max(a, b) ((a) &gt; (b) ? (a) : (b))
const int N = 10010;
int n, ans, tot, a[N], d[N], bit[N];

inline int query(int x) &#123;
    int ret = 0;
    for (; x; x -= x &amp; -x) ret = max(ret, bit[x]);
    return ret;
&#125;

inline void update(int x, int d) &#123;
    for (; x &lt;= tot; x += x &amp; -x) bit[x] = max(bit[x], d);
&#125;

int main() &#123;
    scanf(&quot;%d&quot;, &amp;n); ans = 0;
    for (int i = 1; i &lt;= n; i++) scanf(&quot;%d&quot;, &amp;a[i]);
    copy(a + 1, a + 1 + n, d + 1);
    sort(d + 1, d + 1 + n);
    tot = unique(d + 1, d + 1 + n) - d - 1;
    for (int i = 1; i &lt;= n; i++) &#123;
        int x = lower_bound(d + 1, d + 1 + tot, a[i]) - d;
        update(x, query(x - 1) + 1);
    &#125;
    printf(&quot;%d\n&quot;, query(tot));
    return 0;
&#125;</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://alan20210202.github.io/2021/07/25/%E8%A1%8C%E5%88%97%E5%BC%8F%E8%AE%A1%E7%AE%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/avatar.png">
      <meta itemprop="name" content="Chengyuan Ma">
      <meta itemprop="description" content="不务正业高中生一枚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chengyuan Ma's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/25/%E8%A1%8C%E5%88%97%E5%BC%8F%E8%AE%A1%E7%AE%97/" class="post-title-link" itemprop="url">行列式值的按行列展开定义与排列定义等价性证明</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-25 03:11:41" itemprop="dateCreated datePublished" datetime="2021-07-25T03:11:41-04:00">2021-07-25</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2019-12-13 09:51:56" itemprop="dateModified" datetime="2019-12-13T09:51:56-05:00">2019-12-13</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="行列式值的排列定义">行列式值的排列定义</h1>
<p><span class="math display">\[
A_{n\times n} = \sum_{\pi \in S_n} (-1)^{\sigma(\pi)}\prod_{i=1}^na_{i, \pi(i)}
\]</span></p>
<p>其中<span class="math inline">\(S_n\)</span>表示所有<span class="math inline">\(n\)</span>排列的集合，<span class="math inline">\(\pi\)</span>表示一个排列，<span class="math inline">\(\sigma(\pi)\)</span>表示<span class="math inline">\(\pi\)</span>的逆序对数，即 <span class="math display">\[
\sigma(\pi)=\sum_{i&lt;j}[\pi(i) &gt; \pi(j)]
\]</span></p>
<h1 id="等价性证明">等价性证明</h1>
<p>使用归纳证明。（自己想的，觉得可能绕了很大的弯路。）</p>
<ol type="1">
<li><p><span class="math inline">\(n=1,2,3\)</span>时显然。</p></li>
<li><p>假设<span class="math inline">\(n=k \quad (k \in \mathbb{N^{\ast}})\)</span>时成立，考虑<span class="math inline">\(n=k+1\)</span>时的情况。</p>
<p>不失一般性，考虑第<span class="math inline">\(i\)</span>行展开： <span class="math display">\[
A_{(k + 1) \times (k + 1)} = \sum_{j=1}^{k+1} a_{i,j}(-1)^{i+j}M_{i,j}
\]</span> 其中<span class="math inline">\(M_{i, j}\)</span>为<span class="math inline">\(k\)</span>阶行列式。考虑如何计算<span class="math inline">\(M_{i, j}\)</span>，由归纳假设。 <span class="math display">\[
M_{i,j} = \sum_{\pi \in S_k}(-1)^{\sigma(\pi)}\prod_{l=1, l \neq i}^{k+1} a_{l, \pi&#39;(l)}
\]</span></p>
<p>（后面所有推导用到的<span class="math inline">\(i,j,\pi\)</span>都指上式中的相关符号）其中 <span class="math display">\[
\pi&#39;(l) = \pi(l-[l &gt; i]) + [\pi(l-[l &gt; i])\ge j]
\]</span> 定义<span class="math inline">\(\pi&#39;\)</span>是为了跳过被删去的第<span class="math inline">\(i\)</span>行和第<span class="math inline">\(j\)</span>列，不改变元素间的大小关系。</p>
<p>接下来考虑排列 <span class="math display">\[
\pi^{\ast}(l) = \begin{cases}
 j, &amp;l=i \\
 \pi&#39;(l), &amp;l\neq i
\end{cases}
\]</span> 显然<span class="math inline">\(\pi^{\ast}\)</span>表示了把<span class="math inline">\(i \mapsto j\)</span>“插入”<span class="math inline">\(\pi\)</span>的结果。</p>
<p>观察到 <span class="math display">\[
\begin{aligned}
 \sigma(\pi^{\ast}) &amp;= \sigma(\pi) + \sum_{l=1}^{i-1}[\pi&#39;(l)&gt;j] + \sum_{l=i+1}^{k+1}[\pi&#39;(l)&lt;j] \\
 &amp;= \sigma(\pi) + \underbrace{\sum_{l =1}^{i-1}[\pi(l) \ge j] + \sum_{l=i}^k[\pi(l)&lt;j]}_{\Delta\sigma}
\end{aligned}
\]</span> 接下来只需要证明<span class="math inline">\((-1)^{\Delta\sigma}=(-1)^{i + j}\)</span>。</p>
<p>注意到，可以通过交换元素在任意两个排列之间变换（证明显然略，冒泡排序算法给出了进行此类交换的步骤构造）。为了简便起见，称<span class="math inline">\(l=1,2,3,\cdots,i\)</span>为“前面”，<span class="math inline">\(l=i+1,i+2,\cdots,k\)</span>为“后面”，<span class="math inline">\(\pi(l)&lt;j\)</span>为“小”，<span class="math inline">\(\pi(l) \ge j\)</span>为"大"。</p>
<p>那么显然，前面和前面，后面和后面的交换不改变<span class="math inline">\(\Delta\sigma\)</span>。着重考虑前面后面之间交换的情况。</p>
<p>然后注意到：</p>
<ol type="1">
<li>如果是前面的小元素和后面的大元素进行交换，交换后的<span class="math inline">\(\Delta\sigma\)</span>项增加<span class="math inline">\(2\)</span>。</li>
<li>如果是前面的大元素和后面的小元素进行交换，交换后的<span class="math inline">\(\Delta\sigma\)</span>项减少<span class="math inline">\(2\)</span>。</li>
</ol>
<p>综上，我们可以下结论：虽然在变换排列的过程中，<span class="math inline">\(\Delta\sigma\)</span>项可能会改变，但是<span class="math inline">\((-1)^{\Delta\sigma}\)</span>的值是不会改变的。</p>
<p>这等价于在<span class="math inline">\((i, j)\)</span>固定的情况下，对于任意的<span class="math inline">\(\pi\)</span>，<span class="math inline">\((-1)^{\Delta\sigma}\)</span>都是相同的。</p>
<p>只需要考察一个特例，选取恒等排列<span class="math inline">\(\pi(l)=l\)</span>。</p>
<p>此时 <span class="math display">\[
\begin{aligned}
\Delta\sigma&amp;=\sum_{l =1}^{i-1}[l \ge j] + \sum_{l=i}^k[l&lt;j] \\
&amp;= \min(i - j,0) + \min(j-i,0) \\
&amp;= |i - j|
\end{aligned}
\]</span> 显然<span class="math inline">\((-1)^{|i-j|} = (-1)^{i+j}\)</span>。</p>
<p>因此<span class="math inline">\((-1)^{\Delta\sigma} = (-1)^{i+j}\)</span>。</p>
<p>因此<span class="math inline">\((-1)^{\sigma(\pi^{\ast})} = (-1)^{i+j}(-1)^{\sigma(\pi)}\)</span>。</p>
<p>回到<span class="math inline">\(A\)</span>的计算式： <span class="math display">\[
\begin{aligned}
 A_{(k + 1) \times (k + 1)} &amp;= \sum_{j=1}^{k+1} a_{i,j}(-1)^{i+j}M_{i,j} \\
 &amp;= \sum_{j=1}^{k+1} a_{i,j}(-1)^{i+j}\sum_{\pi \in S_k}(-1)^{\sigma(\pi)}\prod_{l=1, l \neq i}^{k+1} a_{l, \pi&#39;(l)} \\
 &amp;= \sum_{j=1}^{k+1} a_{i,j}\sum_{\pi \in S_k}(-1)^{i+j}(-1)^{\sigma(\pi)}\prod_{l=1, l \neq i}^{k+1} a_{l, \pi&#39;(l)} \\
 &amp;= \sum_{j=1}^{k+1} \sum_{\pi \in S_k}(-1)^{\sigma(\pi^{\ast})}a_{i,j}\prod_{l=1, l \neq i}^{k+1} a_{l, \pi&#39;(l)} \\
 &amp;= \sum_{j=1}^{k+1} \sum_{\pi \in S_k}(-1)^{\sigma(\pi^{\ast})}\prod_{l=1}^{k+1} a_{l, \pi^{\ast}(l)} \\
 &amp;= \sum_{j=1}^{k+1} \sum_{\substack{\pi^{\ast}\in S_{k+1} \\ \pi^{\ast}(i) = j}}(-1)^{\sigma(\pi^{\ast})}\prod_{l=1}^{k+1} a_{l, \pi^{\ast}(l)} \\
 &amp;= \sum_{\pi^{\ast}\in S_{k+1}}(-1)^{\sigma(\pi^{\ast})}\prod_{l=1}^{k+1} a_{l, \pi^{\ast}(l)} \\
 &amp;= \sum_{\pi\in S_{k+1}}(-1)^{\sigma(\pi)}\prod_{i=1}^{k+1} a_{i, \pi(i)}
\end{aligned}
\]</span> 即归纳命题成立，由数学归纳法，得证。</p></li>
</ol>
<h1 id="意义">意义</h1>
<ol type="1">
<li>证明了行列式两种方法的等价性。</li>
<li>证明了行列式挑选任意行/列做展开的结果是等价的，这在行列式按行列展开求值的定义当中并没有那么显然。</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://alan20210202.github.io/2021/07/25/%E8%AE%A8%E5%88%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/avatar.png">
      <meta itemprop="name" content="Chengyuan Ma">
      <meta itemprop="description" content="不务正业高中生一枚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chengyuan Ma's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/25/%E8%AE%A8%E5%88%86/" class="post-title-link" itemprop="url">计一次讨分失败</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-25 03:11:41" itemprop="dateCreated datePublished" datetime="2021-07-25T03:11:41-04:00">2021-07-25</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-07-04 10:38:36" itemprop="dateModified" datetime="2020-07-04T10:38:36-04:00">2020-07-04</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>数学出分了，我最后一题分数被扣光。</p>
<p><img src="/2021/07/25/%E8%AE%A8%E5%88%86/prob.jpg" class=""></p>
<p>我的答案是</p>
<p><img src="/2021/07/25/%E8%AE%A8%E5%88%86/mine.jpg" class=""></p>
<p>而很显然参考答案是</p>
<p><img src="/2021/07/25/%E8%AE%A8%E5%88%86/chen.jpg" class=""></p>
<p>嘛确实是不一样的。但是我的答案和参考答案是等价的啊！</p>
<p><img src="/2021/07/25/%E8%AE%A8%E5%88%86/proof.png" class=""></p>
<p>最多形式不优美，怎落得如此下场？</p>
<p>大概是老师批high了没注意到吧，我想，然后加了老师微信，自信满满地去讨回我失去的6分。</p>
<p>事实证明我还是太天真了。</p>
<blockquote>
<p>你期末分数多少啊？</p>
</blockquote>
<blockquote>
<p>哦，那是好学生啊，好学生看不出来？</p>
</blockquote>
<p>哦豁？！</p>
<blockquote>
<p>如果我没写“用《点到直线距离》一节里的知识”你还可以是对的？</p>
</blockquote>
<p>承认了？</p>
<blockquote>
<p>我说了用《点到直线距离》一节里的知识啊？你是不是没看题？</p>
</blockquote>
<p>不老师，我的条件也是基于点到直线距离的思想的，只是有一个额外的条件罢了。</p>
<blockquote>
<p>你这个额外的条件就是牵 强 附 会！</p>
</blockquote>
<p>我的额外条件和你的<span class="math inline">\(\delta\)</span>的功能是一样的啊……都是用于修正反例的特殊状况，何况我的主条件还是基于距离的。</p>
<blockquote>
<p>你这个充要条件根本没办法用！</p>
</blockquote>
<p>这就说不过去了， 我觉得用这个条件虽卖相不佳，但是真论应用起来不会复杂多少。</p>
<blockquote>
<p><span class="math inline">\(\delta\)</span>书里有你看到没有啊？你没有用<span class="math inline">\(\delta\)</span>就说明你的认知也就这个水平。如果你再坚持，你这方面的数学认知就到顶了，不会再有进步了！</p>
</blockquote>
<p>好，没想到<span class="math inline">\(\delta\)</span>是我的疏忽，但是我很好奇就凭寥寥数语和一道试题如何可以评判认知水平的？</p>
<p>先入为主的自信与居高临下的傲慢。</p>
<blockquote>
<p>你是个好学生，数学追求完美的，因此你要学会去仔细品味正确答案……</p>
</blockquote>
<p>又是好学生，我就不理解了你用这个先入为主的标签作甚？反衬？</p>
<p>数学追求完美还用你教？我承认我的答案形式上没有正解优雅，但是这无损其正确性！</p>
<p>我究竟是被高看了还是低看了？</p>
<blockquote>
<p>分我是不会给的。还有问题吗？</p>
</blockquote>
<p>我明白了。参考答案的简洁确实令人惊叹，谢谢老师。</p>
<p>诶，我究竟是讨分的还是去挨骂的？</p>
<p>老师你要是就事论事说我的答案和预设的方向不对我也就算了，毕竟应试考试难免这样。</p>
<p>你还点评起我的认知和能力来了？</p>
<p>你要是教了我两年就算了，还是在你我只说了几句话的情况下？</p>
<p>是不是每一个眼高手低的教师都有这种自认为见得多了的那种倨傲？我还真是见识了！</p>
<p>附加条件就是有问题，啊？</p>
<p>“追求完美”哈？</p>
<p>你倒是仔细数数从初中到高中有哪些判断的附加条件要加上一句<span class="math inline">\(\Delta &gt; 0\)</span>？那个时候不加附加条件算错，现在加了你又不高兴了？或者说没把附加条件并到<span class="math inline">\(d_1d_2\)</span>变成<span class="math inline">\(\delta_1\delta_2\)</span>你就不高兴了？</p>
<p>解析几何里面很多结论<span class="math inline">\(k\)</span>要存在算不算附加条件？算不算不完美？与之相比是不是向量要好得多，倾斜角要好得多，极坐标要好得多？我们是不是要全员追求完美抛弃有缺陷的斜率？</p>
<p>“用到点到直线距离这一节”哈？</p>
<p><span class="math inline">\(\delta\)</span>是这一节的内容，点到直线的距离就不是了吗？</p>
<p>都写了“试写出”了还整唯一标准答案？</p>
<p>我的答案和你的完全等价诶！</p>
<p>证明的思路也和你的大同小异诶！</p>
<p>就这样把所有分扣光？</p>
<p>我的结论好歹是对的，是不是应该和那些结论都是错的做一点区分？</p>
<p>就这样把一个90分以上黜落到90分一下？</p>
<p>很遗憾，虽然我理解了老师的理论（这无疑是一种可悲），但是从老师对我的态度我只能读出一种面对完全不认识的学生，一种不知何起的居高临下的自负与倨傲。</p>
<p>题目和答案都不错，我回去会好好欣赏的。</p>
<p>但这个老师就算了，我很庆幸高中前两年不是他教。</p>
<p>诶，自己真蠢，刚做题的时候天真地想期末大考能出出开放性探究题，讨分的时候天真地想老师或许只是疏忽而已。</p>
<p>到最后自讨没趣，只能在一个网络上无人问津的角落，乱发一通牢骚。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://alan20210202.github.io/2021/07/25/%E7%BB%84%E5%90%88%E6%B1%82%E5%92%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/avatar.png">
      <meta itemprop="name" content="Chengyuan Ma">
      <meta itemprop="description" content="不务正业高中生一枚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chengyuan Ma's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/25/%E7%BB%84%E5%90%88%E6%B1%82%E5%92%8C/" class="post-title-link" itemprop="url">论省选中有意思的一道组合题</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-25 03:11:41" itemprop="dateCreated datePublished" datetime="2021-07-25T03:11:41-04:00">2021-07-25</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-06-27 08:01:12" itemprop="dateModified" datetime="2020-06-27T08:01:12-04:00">2020-06-27</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>省选结束了，本人作为划水3年的OIer宣告原地退役，唯一写出正解的是D1T2。我其实觉得这道题挺有意思的（虽然大佬们都说只是推式子而已……嘛，毕竟本来没期待自己能做出来），就写篇文章记一下自己的想法吧。</p>
<h1 id="题意">题意</h1>
<p>给定整数<span class="math inline">\(n, x, P\le 10^9\)</span>，以及一个<span class="math inline">\(m \le 1000\)</span>次整系数多项式<span class="math inline">\(f\)</span>，求 <span class="math display">\[
\left[\sum_{k=0}^nf(k)x^k\binom{n}{k}\right]\bmod P
\]</span></p>
<h1 id="心路历程">心路历程</h1>
<h2 id="先乱搞一波">先乱搞一波</h2>
<p>看到这个题目的第一眼我觉得颇为眼熟。虽然没学过奥数，印象当中《具体数学》里面花了很大笔墨讲由这种指数，多项式以及二项式系数组合而成的和式的处理方法，似乎最后也讲到了机械求和法，然并卵，印象止步于印象，机械求合法太复杂了自己并没有记下来。</p>
<p>但是自己的残存记忆告诉我机械求和法的第一步是把求和式化成超几何函数，虽然后者我更没办法但是本着有逼就要装的思想……为什么不试一试呢？</p>
<p>什么样的级数是超几何的？《具体数学》里面给出的方法是求相邻项之比<del>幸好这个我还没有忘记</del>，而显而易见地是多项式求比是求不出具有良好形式的结果的，因此<strong>多项式必须转化为性质更优良的下降阶乘幂处理</strong>（关于下降阶乘幂我记得两年之前就写过一篇成套方法和有限微积分的博文，现在想来下降阶乘幂在离散求和问题当中真的有非常良好的性质，我在这里就沿用《具体数学》里的记号了：<span class="math inline">\(k^{\underline m} = \prod_{i=0}^m (k-i)\)</span>）： <span class="math display">\[
\begin{aligned}
\frac{(k+1)^{\underline{m}}x^{k+1}\binom{n}{k+1}}{k^{\underline{m}}x^k\binom{n}{k}} &amp;= \frac{(k+1)x(n-k)}{(k-m+1)(k+1)} \\
&amp;= \frac{(n-k)x}{k-m+1}
\end{aligned}
\]</span> 不出所料，结果是一个有理函数，也就是说可以化成高斯超几何函数呢！</p>
<p>不出所料，半瓶水的某人也就知道这些了（悲）。</p>
<p>但是<strong>下降阶乘幂的思想是可以有的嘛</strong>！</p>
<h2 id="部分分摸鱼">部分分摸鱼</h2>
<p>在乱搞如预想的那般失败之后我就开始看部分分。</p>
<p>部分分里面有一个<span class="math inline">\(f\)</span>是常数的，愣了一会发现能用二项式定理，答案是<span class="math inline">\((1+x)^n\)</span>。</p>
<p>然后还有一个<span class="math inline">\(x=1\)</span>的。这个要怎么解决？</p>
<p>从最简单的一次多项式开始： <span class="math display">\[
\sum_{k=0}^nk\binom{n}{k}=?
\]</span> 推式子本人是不会的，结论也忘了，但是从组合意义上还是好想的：<strong><span class="math inline">\(k\binom{n}{k}\)</span>就是从<span class="math inline">\(n\)</span>个人里面选<span class="math inline">\(k\)</span>个人，然后钦定一个做队长的方案数，把它求和，就是从<span class="math inline">\(n\)</span>个人里面选若干人，然后从当中钦定一个队长的方案数。</strong>这是先选人再定队长的顺序，我们可以先选队长再选人嘛！从<span class="math inline">\(n\)</span>个人里面选一个队长有<span class="math inline">\(n\)</span>种方法，剩下的<span class="math inline">\((n-1)\)</span>个人要不要都行，所以是<span class="math inline">\(2^{n-1}\)</span>种，二者相乘： <span class="math display">\[
\sum_{k=0}^nk\binom{n}{k}=n2^{n-1}
\]</span> 就把一次的式子推出来了。</p>
<p>那二次的式子呢？ <span class="math display">\[
\sum_{k=0}^nk^2\binom{n}{k}=?
\]</span> 如果沿用之前运用组合意义化简的思路，那<span class="math inline">\(k^2\)</span>就有“可以重复选”的含义在，是不好处理的。但是之前的乱搞告诉我们，是不是化成下降阶乘幂会好处理一点呢？ <span class="math display">\[
\sum_{k=0}^nk(k-1)\binom{n}{k}=?
\]</span> 答案是肯定的，思路和一次的完全一样，只是从“选队长”变成了“选队长和副队长“，因此很快就可以得出： <span class="math display">\[
\sum_{k=0}^nk(k-1)\binom{n}{k}=n(n-1)2^{n-2}
\]</span> 然后就可以很快地推广出去了： <span class="math display">\[
\sum_{k=0}^nk^{\underline{m}}\binom{n}{k}=n^{\underline{m}}2^{n-m}
\]</span> 这样几个部分分就基本拿到了。</p>
<h2 id="把两者组合起来">把两者组合起来</h2>
<p>那如果<span class="math inline">\(x\neq 1\)</span>且<span class="math inline">\(f\)</span>非常数要怎么做呢？我们不妨还是把<span class="math inline">\(f\)</span>想成下降阶乘幂（怎么拆另说）： <span class="math display">\[
\sum_{k=0}^nk^{\underline{m}}x^k\binom{n}{k}=?
\]</span> 然后思考其组合意义，稍开脑洞即可得到：</p>
<p><strong><span class="math inline">\(k^{\underline{m}}x^k\binom{n}{k}\)</span>是从<span class="math inline">\(n\)</span>个人里面挑选<span class="math inline">\(k\)</span>个人，再给让当中<span class="math inline">\(m\)</span>人担任<span class="math inline">\(m\)</span>个不同职位，最后再让每个人从<span class="math inline">\(x\)</span>种颜色的帽子当中选一个戴上的方案数</strong>（不要问我怎么想到戴帽子的）。</p>
<p>因此，由加法原理，对其求和之后就是从<span class="math inline">\(n\)</span>个人里面挑选<em>若干</em>个人，再给让当中<span class="math inline">\(m\)</span>人担任<span class="math inline">\(m\)</span>个不同职位，最后再让每个人从<span class="math inline">\(x\)</span>种颜色的帽子当中选一个戴上的方案数。</p>
<p>那我们故技重施，调换顺序，不妨先从<span class="math inline">\(n\)</span>个人当中调出担任<span class="math inline">\(m\)</span>个职位的那<span class="math inline">\(m\)</span>个人（<span class="math inline">\(n^{\underline{m}}\)</span>种取法），再先让他们先选帽子（<span class="math inline">\(x^m\)</span>种选法），然后让剩下的<span class="math inline">\((n-m)\)</span>个人要不挑一个颜色的帽子进队要么滚蛋（<span class="math inline">\((1+x)^{n-m}\)</span>种取法）。于是就有了： <span class="math display">\[
\sum_{k=0}^nk^{\underline{m}}x^k\binom{n}{k}=n^{\underline{m}}x^m(1+x)^{n-m}
\]</span> 哇，式子就推出来了！</p>
<h2 id="多项式拆分">多项式拆分</h2>
<p>现在基于下降阶乘幂的式子已经推出来了，唯一剩下的就是把给定的<span class="math inline">\(f\)</span>拆成若干个下降阶乘幂的线性组合。 <span class="math display">\[
\sum_{i=0}^ma_ik^i = \sum_{j=0}^m b_jk^{\underline{j}}
\]</span> 即求<span class="math inline">\(b_j\)</span>的过程。</p>
<p>显而易见地，我们需要从高次到低次拆，这样后拆出来的幂才不会对之前的结果造成影响。</p>
<p>同时显然的是，我们需要知道下降阶乘幂展开后对应多项式的系数。</p>
<p>现在回过来看，朴素的多项式乘法是完全可以胜任的。但是写多项式乘法毕竟比较繁琐，不如观察多项式系数的规律。</p>
<p>令<span class="math inline">\(c[m, n]\)</span>表示下降阶乘幂<span class="math inline">\(x^{\underline m}\)</span>的展开式当中<span class="math inline">\(x^n\)</span>的系数。则由下降阶乘幂的定义： <span class="math display">\[
x^{\underline m} = x^{\underline{m-1}}[x-(m-1)],\quad (m\ge 1)
\]</span> 可以得出递推式： <span class="math display">\[
c[m,n]=c[m-1,n-1]-(m-1)c[m-1,n]
\]</span> 边界条件是<span class="math inline">\(c[0,0] = 1\)</span>以及<span class="math inline">\(c[m,0]=0\quad \forall m&gt;0\)</span>。这是一个类似杨辉三角的递推式，自然可以在<span class="math inline">\(\mathcal{O}\left(m^2\right)\)</span>的时间内算出来，代码也好写。</p>
<p>至此，这道题目就完全解决了。</p>
<p>其实不止如此，这个三角在考场上让我感到非常眼熟，回去查证了一下，果然<span class="math inline">\(c[m,n]\)</span>就是所谓的<strong>带符号的第一类斯特林数</strong>，“下降阶乘幂的展开系数”正是其重要的性质之一。</p>
<h2 id="感想">感想</h2>
<p>这道题对我的感触是比较深刻的，尤其是做出来之后，颇有一种成就感。</p>
<p>细想来，我组合数学的公式其实几乎都没有背过，故而几乎所有的式子都是现场推出来的。而且推理的方式也不纯代数的暴算，而是通过combinatorial proof的方式。自从PACT学来这招之后我觉得这种方法实在是精妙。在最后自己还稀里糊涂地推演出了斯特林数的递推公式，或许这种高大上的组合数本身离我们就不遥远吧。</p>
<p>而话又说回来，大佬们看我写的这篇文章，只怕有些不耐烦与乏味吧。那些认真学习过组合数学的选手，大概看到这道题只剩下满满的套路，毕竟斯特林数名声在外，falling factorial这个套路熟悉了也不难想到，而类似的组合式子大概课后的习题会有很多吧。看到诸多大佬将D1T2云淡风轻地说成“裸的推式子”，他们做这道题时的从容大概可见一斑。只有像自己这样偶尔翻翻《组合数学》和《具体数学》，半瓶水晃荡的，才会在考场上各种心情复杂，一惊一乍了。</p>
<p>然而换一个角度，我觉得这道题对我来说真的不错，自己之前偶尔翻翻书也是。作为一道数学题，这道题并没有远远超出我的见识让我一筹莫展，也没有远远低于我的见识让我秒杀，恰是我稍微努力一下就能解决的。而这次考试正是给了日渐颓废，游手好闲的我一个“努力一下”的契机。就结果来看，解决这道题不仅给了我市选的信心，也给了我组合数学的信心，还让我在结题过程中观赏到了极佳的风景，似乎确实不赖。尤其是后者，若放在平时做题，随时可以查找资料，正确答案触手可及，那结论得出时大概也不会有考场上那么惊喜，那么愉悦了。</p>
<h2 id="逆-转">逆 转</h2>
<p>啊？出分了？！</p>
<p>我考个250都能压线进队？！</p>
<p>我可是根本就没认真复习啊，半年没碰OI了……</p>
<p>唉，看来这次强行退役失败了，心情复杂……</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://alan20210202.github.io/2021/07/25/%E8%8E%AB%E6%AF%94%E4%B9%8C%E6%96%AF%E5%8F%8D%E6%BC%94/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/avatar.png">
      <meta itemprop="name" content="Chengyuan Ma">
      <meta itemprop="description" content="不务正业高中生一枚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chengyuan Ma's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/25/%E8%8E%AB%E6%AF%94%E4%B9%8C%E6%96%AF%E5%8F%8D%E6%BC%94/" class="post-title-link" itemprop="url">莫比乌斯反演</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-25 03:11:41" itemprop="dateCreated datePublished" datetime="2021-07-25T03:11:41-04:00">2021-07-25</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-07-30 04:26:48" itemprop="dateModified" datetime="2020-07-30T04:26:48-04:00">2020-07-30</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>莫比乌斯反演是OI中应对数论问题的一大杀器，可以把很多以前需要脑子想的问题无脑化，把很多脑子想不通的问题机械化，非常方便。</p>
<h1 id="狄利克雷卷积">狄利克雷卷积</h1>
<p>对于函数<span class="math inline">\(f, g\)</span>，定义它们的狄利克雷卷积<span class="math inline">\(f \times g\)</span>为： <span class="math display">\[
(f \times g)(n) = \sum_{d \mid n} f(d)g\left(\frac{n}{d}\right)
\]</span></p>
<h2 id="性质">性质</h2>
<h3 id="积性">积性</h3>
<p>若<span class="math inline">\(f, g\)</span>为积性函数，那么<span class="math inline">\(f \times g\)</span>继承它们的积性。</p>
<p><strong>证明：</strong>令<span class="math inline">\(n, m\)</span>为互素正整数，则易证<span class="math inline">\(nm\)</span>的全体约数可以<em>不重不漏地</em>表示为<span class="math inline">\(\{d_nd_m \mid d_n \mid n, d_m \mid m\}\)</span>。</p>
<p>因此： <span class="math display">\[
\begin{aligned}
(f \times g)(nm) &amp;= \sum_{d | n} f(d)g\left(\frac{nm}{d}\right) \\
&amp;= \sum_{d_n\mid n} \sum_{d_m \mid m} f(d_nd_m)g\left(\frac{nm}{d_nd_m}\right)
\end{aligned}
\]</span> 由<span class="math inline">\(n, m\)</span>互素可知<span class="math inline">\(d_n, d_m\)</span>互素以及<span class="math inline">\(\frac{n}{d_n}, \frac{m}{d_m}\)</span>互素，结合<span class="math inline">\(f, g\)</span>的积性： <span class="math display">\[
\begin{aligned}
\begin{aligned}
(f \times g)(nm) &amp;= \sum_{d_n\mid n} \sum_{d_m \mid m} f(d_n)f(d_m)g\left(\frac{n}{d_n}\right)g\left(\frac{m}{d_m}\right) \\
&amp;= \sum_{d_n\mid n} f(d_n)g\left(\frac{n}{d_n}\right) \sum_{d_m \mid m} f(d_m)g\left(\frac{m}{d_m}\right) \\
&amp;= (f \times g)(n) \cdot (f \times g)(m)
\end{aligned}
\end{aligned}
\]</span> 证毕。</p>
<h3 id="交换律">交换律</h3>
<p><span class="math display">\[
f \times g = g \times f
\]</span></p>
<p><strong>证明：</strong>由于约数是成对出现的，显然。</p>
<h3 id="结合律">结合律</h3>
<p><span class="math display">\[
(f \times g) \times h = f \times (g \times h)
\]</span></p>
<p><strong>证明：</strong>我们需要稍微改变一下下标的写法，然后就非常清楚了： <span class="math display">\[
\begin{aligned}
\left[(f \times g) \times h \right](n) &amp;= \sum_{ab = n} (f \times g)(a) h(b) \\
&amp;= \sum_{ab = n} \sum_{cd = a}f(c)g(d) h(b) \\
&amp;= \sum_{bcd = n} f(c)g(d)h(b) \\
&amp;= \sum_{ce = n} f(c) \sum_{bd = e} g(d)h(b) \\
&amp;= \sum_{ce = n} f(c) (g \times h)(b) \\
&amp;= \left[f \times (g \times h)\right](n)
\end{aligned}
\]</span></p>
<p>得证。</p>
<h3 id="单位元">单位元</h3>
<p>定义 <span class="math display">\[
\varepsilon(n) = [n = 1]
\]</span> 易证<span class="math inline">\(\varepsilon\)</span>为狄利克雷卷积的单位元，<em>也是一个积性函数</em>，在之后的反演当中，我们也经常会把<span class="math inline">\(\varepsilon\)</span>作为艾弗森括号<span class="math inline">\([]\)</span>的替代品，因为它具有更优良的性质，简单来说： <span class="math display">\[
[f(x) = y] = \varepsilon\left(\frac{f(x)}{y}\right)
\]</span></p>
<h2 id="推论">推论</h2>
<p>关于狄利克雷卷积我们有两条非常重要的推论： <span class="math display">\[
\begin{aligned}
\mu \times 1 &amp;= \varepsilon \\
\varphi \times 1 &amp;= I
\end{aligned}
\]</span> 当中<span class="math inline">\(1\)</span>为值恒为<span class="math inline">\(1\)</span>的常值函数，<span class="math inline">\(I(x) = x\)</span>为恒等函数，易证这两个都是完全积性函数。</p>
<p><strong>证明：</strong>我们先证明第一条，假设<span class="math inline">\(n &gt; 1\)</span>有<span class="math inline">\(r\)</span>个素因子，从当中挑去若干个相乘组成<span class="math inline">\(n\)</span>的<strong>不含平方素因子</strong>的约数（如果约数含平方素因子则约数的<span class="math inline">\(\mu\)</span>为<span class="math inline">\(0\)</span>，可以直接忽略）则我们有： <span class="math display">\[
\begin{aligned}
(\mu \times 1)(n) &amp;= \sum_{i = 0}^r \binom{r}{i} (-1)^i \\
&amp;= \sum_{i = 0}^r \binom{r}{i} (-1)^i\cdot 1^{r - i}
\end{aligned}
\]</span> 结合二项式定理，得到<span class="math inline">\((\mu \times 1)(n) = (1-1)^r=0\)</span>，而如果<span class="math inline">\(n = 1\)</span>，手动展开得到<span class="math inline">\((\mu \times 1)(1) = \mu(1) = 1\)</span>。两种情况结合起来得到<span class="math inline">\(\mu \times 1 = \varepsilon\)</span>，第一条推论得证。</p>
<p>对于第二条推论，我们将其展开： <span class="math display">\[
\sum_{d \mid n} \varphi(i) = n
\]</span> 我们先考察<span class="math inline">\(n\)</span>为素数（或其幂次）的情况，设<span class="math inline">\(n = p^k\)</span>，则原式左边变为： <span class="math display">\[
\begin{aligned}
\sum_{i = 0}^k \varphi(p^i) &amp;= 1 +\sum_{i = 1} ^ k p^i\left(1 - {1 \over p}\right) \\
&amp;= 1 + \left(1 - {1 \over p}\right)\sum_{i = 1} ^ k p^i \\
&amp;= 1 + \frac{p - 1}{p} \cdot \frac{p^{k + 1} - p}{p - 1} \\
&amp;= 1 + p^k - 1 \\
&amp;= p^k
\end{aligned}
\]</span> 因此在<span class="math inline">\(n\)</span>为素数或其幂次时推论得证，而我们知道<span class="math inline">\(\varphi \times 1\)</span><strong>继承了积性</strong>，因此我们可以<strong>利用积性把推论推广到<span class="math inline">\(n\)</span>不为素数的情况</strong>（通过分解素因数即可），证毕。</p>
<h1 id="莫比乌斯反演">莫比乌斯反演</h1>
<p><strong>定理：</strong><span class="math inline">\(f \times 1 = g\)</span>当且仅当<span class="math inline">\(f = g \times \mu\)</span>。</p>
<p><strong>证明：</strong>本质上是狄利克雷卷积的推论的推论，先正着来一轮，两边同时乘以<span class="math inline">\(\mu\)</span>： <span class="math display">\[
\begin{aligned}
f \times 1 &amp;= g \\
\Rightarrow f \times 1 \times \mu &amp;= g \times \mu \\
\Rightarrow f \times \varepsilon &amp;= g \times \mu \\
\Rightarrow f &amp;= g \times \mu \\
\end{aligned}
\]</span> 我们再反着来一轮，两边同时乘上<span class="math inline">\(1\)</span>： <span class="math display">\[
\begin{aligned}
f &amp;= g \times \mu \\
\Rightarrow f \times 1 &amp;= g \times \mu \times 1 \\
\Rightarrow f \times 1 &amp;= g \times \varepsilon \\
\Rightarrow f \times 1 &amp;= g
\end{aligned}
\]</span> （所以说不要迷行网上那种大力出奇迹几个<span class="math inline">\(\sum\)</span>展开来回套的证明，看这个多简单）</p>
<p><strong>虽然存在这个莫比乌斯反演定理，但是我们更多的时候还是习惯逆用狄利克雷卷积的那两个推论。</strong></p>
<h2 id="示例varphin">示例：<span class="math inline">\(\varphi(n)\)</span></h2>
<p><span class="math display">\[
\begin{aligned}
\varphi(n) &amp;= \sum_{i = 1}^n [\gcd(i, n) = 1] \\
&amp;= \sum_{i = 1}^n \varepsilon(\gcd(i, n)) \\
\end{aligned}
\]</span></p>
<p>此时我们使用推论<span class="math inline">\(\varepsilon = \mu \times 1\)</span>： <span class="math display">\[
\begin{aligned}
\varphi(n) &amp;= \sum_{i = 1}^n \varepsilon(\gcd(i, n)) \\
&amp;= \sum_{i = 1}^n \sum_{d \mid \gcd(i, n)} \mu(d) \\
&amp;= \sum_{i = 1}^n \sum_{d \mid i, d \mid n} \mu(d) \\
\end{aligned}
\]</span> 接下来我们把<span class="math inline">\(d\)</span>的求和拖到前面去，本质上是从<strong>对约数求和变为对倍数算贡献</strong>： <span class="math display">\[
\begin{aligned}
\varphi(n) &amp;= \sum_{i = 1}^n \sum_{d \mid i, d \mid n} \mu(d) \\
&amp;= \sum_{d \mid n} \mu(d) \sum_{i = 1, d \mid i}^n 1 \\
&amp;= \sum_{d \mid n} \mu(d) \sum_{i = 1}^{n \over d} 1 \\
&amp;= \sum_{d \mid n} \mu(d) \frac{n}{d} \\
&amp;= \sum_{d \mid n} \mu(d) I\left(\frac{n}{d}\right) \\
&amp;= (\mu \times id)(n)
\end{aligned}
\]</span> 因此我们证明了<span class="math inline">\(\varphi = \mu \times id\)</span>，虽然这个结论是可以直接从莫比乌斯反演定理推得的，但是呢，这个例子确实展示了莫比乌斯反演的很多常用套路：</p>
<ol type="1">
<li>把式子写下来</li>
<li>用<span class="math inline">\(id\)</span>或者<span class="math inline">\(\varepsilon\)</span>修饰</li>
<li>逆用狄利克雷卷积的推论，把求和式后面反演成卷积形式</li>
<li>通过算贡献的方式设法把<span class="math inline">\(d\)</span>的求和项连带着只和<span class="math inline">\(d\)</span>有关的函数值一起拖到最前面</li>
<li>化简后半部分</li>
</ol>
<p>这一路下来其实是非常套路的，但往往效果拔群。</p>
<h2 id="示例sum_i-1n-varphii">示例：<span class="math inline">\(\sum_{i = 1}^n \varphi(i)\)</span></h2>
<p><strong>以下为了方便起见，如果出现<span class="math inline">\(n, m\)</span>，皆假设<span class="math inline">\(n \le m\)</span>！</strong></p>
<p>我们试试看刚刚学到的套路，来反演欧拉函数的前缀和： <span class="math display">\[
\begin{aligned}
\sum_{i = 1}^n \varphi(i) &amp;= \sum_{i = 1}^n \sum_{j = 1}^i [\gcd(i, j) = 1] \\
&amp;= \sum_{i = 1}^n \sum_{j = 1}^i \varepsilon(\gcd(i, j) = 1) \\
&amp;= \sum_{i = 1}^n \sum_{j = 1}^i \sum_{d \mid \gcd(i, j)} \mu(d) \\
&amp;= \sum_{i = 1}^n \sum_{j = 1}^i \sum_{d \mid i, d \mid j} \mu(d) \\
&amp;= \sum_{d = 1}^n \mu(d) \sum_{i = 1, d \mid i}^n \sum_{j = 1, d \mid j}^i 1\\
&amp;= \sum_{d = 1}^n \mu(d) \sum_{i = 1}^{\left\lfloor \frac{n}{d} \right\rfloor} \sum_{j = 1}^i 1\\
&amp;= \sum_{d = 1}^n \mu(d) \sum_{i = 1}^{\left\lfloor \frac{n}{d} \right\rfloor} i\\
&amp;= \sum_{d = 1}^n \mu(d) \frac{\left\lfloor \frac{n}{d} \right\rfloor \left(\left\lfloor \frac{n}{d} \right\rfloor + 1\right)}{2}\\
&amp;= \frac{1}{2} \sum_{d = 1}^n \mu(d) \left\lfloor \frac{n}{d} \right\rfloor \left(\left\lfloor \frac{n}{d} \right\rfloor + 1\right)
\end{aligned}
\]</span> 嗯，很好，很强大，但是这个有什么用呢？</p>
<h2 id="示例sum_i-1n-sum_j-1n-gcdi-j-1">示例：<span class="math inline">\(\sum_{i = 1}^n \sum_{j = 1}^n [\gcd(i, j) = 1]\)</span></h2>
<p>这个式子对应POJ3090，即有一个<span class="math inline">\(n \times n\)</span>个格点，问从最左下角能够看到几个格点，我们发现如果格点<span class="math inline">\((i, j)\)</span>不互素的话，它一定不会被看到，因此题目就被转化成了我们要求的式子，常规做法是通过把格点劈成三角形，进行转化得到答案为<span class="math inline">\(2\sum_{i = 1}^n \varphi(n) - 1\)</span>，但是这毕竟还需要一点智商，而如果你莫比乌斯反演熟练的话，这个东西推起来是非常机械化的： <span class="math display">\[
\begin{aligned}
\sum_{i = 1}^n \sum_{j = 1}^n [\gcd(i, j) = 1] &amp;= \sum_{i = 1}^n \sum_{j = 1}^n \varepsilon(\gcd(i, j) = 1)\\
&amp;= \sum_{i = 1}^n \sum_{j = 1}^n \sum_{d \mid i, d \mid j} \mu(d)\\
&amp;= \sum_{d = 1}^n \mu(d) \sum_{i = 1, d \mid i}^n \sum_{j = 1, d \mid j}^n 1 \\
&amp;= \sum_{d = 1}^n \mu(d) \sum_{i = 1}^{\left\lfloor \frac{n}{d} \right\rfloor} \sum_{j = 1}^{\left\lfloor \frac{n}{d} \right\rfloor} 1 \\
&amp;= \sum_{d = 1}^n \mu(d) \left\lfloor \frac{n}{d} \right\rfloor^2 \\
&amp;= 2 \left( \frac{1}{2} \sum_{d = 1}^n \mu(d) \left\lfloor \frac{n}{d} \right\rfloor \left(\left\lfloor \frac{n}{d} \right\rfloor + 1\right) \right) - \sum_{d = 1}^n \mu(d) \left\lfloor \frac{n}{d} \right\rfloor \\
&amp;= 2\sum_{i = 1}^n \varphi(i) - \sum_{d = 1}^n \mu(d) \left\lfloor \frac{n}{d} \right\rfloor
\end{aligned}
\]</span> 那么<span class="math inline">\(\sum_{d = 1}^n \mu(d) \left\lfloor \frac{n}{d} \right\rfloor\)</span>又是什么呢？我们借着套路反着反演： <span class="math display">\[
\begin{aligned}
\sum_{d = 1}^n \mu(d) \left\lfloor \frac{n}{d} \right\rfloor &amp;= \sum_{d = 1}^n \mu(d) \sum_{i = 1, d \mid i}^n 1 \\
&amp;= \sum_{i = 1}^n \sum_{d \mid i} \mu(d) \\
&amp;= \sum_{i = 1}^n (\mu \times 1)(d) \\
&amp;= \sum_{i = 1}^n \varepsilon(i) \\
&amp;= 1
\end{aligned}
\]</span> 原来这个是<span class="math inline">\(1\)</span>啊，那么带回去我们就得到了： <span class="math display">\[
\sum_{i = 1}^n \sum_{j = 1}^n [\gcd(i, j) = 1] = 2\sum_{i = 1}^n \varphi(i) - 1
\]</span> 以上推导中我们完全没有用到<span class="math inline">\(\varphi, \mu\)</span>的数学意义，而是顺着我们推导出的狄利克雷卷积的规则和推论进行着机械化的推导，最后也殊途同归，也许有些人会觉得这样没有卵用，那么试解： <span class="math display">\[
\sum_{i = 1}^n \sum_{j = 1}^m [\gcd(i, j) = 1]
\]</span> 借助图形和数学意义的人看到这个式子大概就去世了，但是如果我们利用反演的话，类似以上的过程可以推得： <span class="math display">\[
\sum_{i = 1}^n \sum_{j = 1}^m [\gcd(i, j) = 1] = \sum_{d = 1}^n \mu(d) \left\lfloor \frac{n}{d} \right\rfloor \left\lfloor \frac{m}{d} \right\rfloor
\]</span> 结合整除分块和<span class="math inline">\(O(n)\)</span>预处理莫比乌斯函数的前缀和我们就可以在<span class="math inline">\(O(\sqrt n)\)</span>的时间里回答每一个询问，这就是莫比乌斯反演的强大之处。</p>
<h2 id="示例sum_i-1n-sum_j-1m-gcdi-j">示例：<span class="math inline">\(\sum_{i = 1}^n \sum_{j = 1}^m \gcd(i, j)\)</span></h2>
<p>观察这个式子，我们发现和上面实例中式子的唯一不同就是我们把<span class="math inline">\(\varepsilon\)</span>换成了<span class="math inline">\(id\)</span>，对应下来就是<span class="math inline">\(\mu\)</span>换成了<span class="math inline">\(\varphi\)</span>，因此我们可以得到： <span class="math display">\[
\sum_{i = 1}^n \sum_{j = 1}^m \gcd(i, j) = \sum_{d = 1}^n \varphi(d) \left\lfloor \frac{n}{d} \right\rfloor \left\lfloor \frac{m}{d} \right\rfloor
\]</span> 依然是<span class="math inline">\(O(n)\)</span>预处理<span class="math inline">\(O(\sqrt n)\)</span>查询！</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://alan20210202.github.io/2021/07/25/%E7%BB%84%E5%90%88%E6%81%92%E7%AD%89%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/avatar.png">
      <meta itemprop="name" content="Chengyuan Ma">
      <meta itemprop="description" content="不务正业高中生一枚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chengyuan Ma's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/25/%E7%BB%84%E5%90%88%E6%81%92%E7%AD%89%E5%BC%8F/" class="post-title-link" itemprop="url">论一个有趣组合恒等式的证明</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-25 03:11:41" itemprop="dateCreated datePublished" datetime="2021-07-25T03:11:41-04:00">2021-07-25</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2020-01-28 07:33:04" itemprop="dateModified" datetime="2020-01-28T07:33:04-05:00">2020-01-28</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="问题">问题</h1>
<p>前几天在做探究性题目的时候碰到了一个组合恒等式： <span class="math display">\[
\sum_{k=1}^nk2^k\binom{2n-k-1}{n-1}=n\binom{2n}{n}
\]</span> 这个恒等式的右边最初是Mathematica给出的，当时把就我惊到了，一开始想用combinatorial proof的方法来证，但是想了两个晚上也想不出，自己的数学实在是太烂啦=_= 之后在翻《具体数学》的时候学了一点超几何函数的皮毛，总算使用超几何的方法诡异地证出来了。我又在Math StackExchange上发帖征集了一些初等的证明，在这里做一个汇总。</p>
<h1 id="初等证明">初等证明</h1>
<p><strong>引理1：</strong> <span class="math display">\[
\sum_{k=n}^{2n}2^{-k}\binom{k}{n}=1
\]</span> <strong>证明：</strong>源于<a target="_blank" rel="noopener" href="https://math.stackexchange.com/questions/1782432/how-to-prove-that-sum-i-0n-2i-binom2n-in-4n">这个帖子</a>。这个式子等价于： <span class="math display">\[
\sum_{k=n}^{2n}2^{2n-k}\binom{k}{n}=4^n \Rightarrow \sum_{k=0}^{n}2^{k}\binom{2n-k}{n}=4^n
\]</span> 利用数学归纳法，令 <span class="math display">\[
\begin{aligned}
    S_n&amp;=\sum_{k=0}^{n}2^{k}\binom{2n-k}{n}\\
    &amp;=\sum_{k=0}^{n}2^{k}\binom{2n-k}{n-k} \\
    &amp;=\sum_{k=0}^{n}2^{n-k}\binom{n+k}{n}
\end{aligned}
\]</span> 于是 <span class="math display">\[
\begin{aligned}
    S_{n+1} &amp;= \sum_{k=0}^{n+1}2^{n+1-k}\binom{n+1+k}{n+1} \\
    &amp;= \sum_{k=0}^{n+1}2^{n+1-k}\left[\binom{n+k}{n+1} + \binom{n+k}{n}\right] \\
    &amp;= \binom{2n+1}{n} + 2\sum_{k=0}^{n}2^{n-k}\binom{n+k}{n} + \sum_{k=0}^{n+1}2^{n+1-k}\binom{n+k}{n+1}\\
    &amp;= \binom{2n+1}{n} + 2S_n + \binom{2n+1}{n+1} + \sum_{k=1}^{n}2^{n+1-k}\binom{n+k}{n+1} \\
    &amp;= \binom{2n+2}{n+1} + 2\cdot4^n + \sum_{k=0}^{n-1}2^{n-k}\binom{n+1+k}{n+1} \\
    &amp;= \binom{2n+2}{n+1} + 2\cdot4^n + \frac{1}{2}\left[\sum_{k=0}^{n+1}2^{n+1-k}\binom{n+1+k}{n+1}-2\binom{2n+1}{n+1}-\binom{2n+2}{n+1}\right] \\
    &amp;= 2\cdot4^n + \frac{1}{2}S_{n+1} \\
    \Rightarrow S_{n+1}&amp;=4^{n+1}
\end{aligned}
\]</span></p>
<p>结合数学归纳法，得证。</p>
<p><strong>引理2：</strong> <span class="math display">\[
\sum_{p=m}^{2m}p2^{-p}\binom{p}{m} = (2m+1)-\frac{m+1}{2^{2m+1}}\binom{2m+2}{m+1}
\]</span> <strong>证明：</strong>源于<a target="_blank" rel="noopener" href="https://math.stackexchange.com/questions/3508530/help-in-summing-sum-k-m-2m-k-cdot-2-k-k-choose-m/3508683#3508683">这个帖子</a>。 <span class="math display">\[
\begin{aligned}
\sum_{p=m}^{2m}p2^{-p}\binom{p}{m} &amp;= \sum_{p=m}^{2m}(p+1)2^{-p}\binom{p}{m} -\sum_{p=m}^{2m}2^{-p}\binom{p}{m} \\
&amp;= \sum_{p=m}^{2m}(m+1)2^{-p}\binom{p+1}{m+1} - 1\\
&amp;= (m+1) \left[2\sum_{p+1=m+1}^{2m+2}2^{-(p+1)}\binom{p+1}{m+1}-2^{-2m-1}\binom{2m+2}{m+1}\right] - 1 \\
&amp;= (m+1)\left[2-\frac{1}{2^{2m+1}}\binom{2m+2}{m+1}\right] - 1\\
&amp;= (2m+1)-\frac{m+1}{2^{2m+1}}\binom{2m+2}{m+1}
\end{aligned}
\]</span> 得证。</p>
<p><strong>原式证明：</strong>结合引理1和2，令<span class="math inline">\(m=n-1,p=2n-k-1\)</span>： <span class="math display">\[
\begin{aligned}
    \sum_{k=1}^nk2^k\binom{2n-k-1}{n-1}&amp;=\sum_{p=m}^{2m}(2m+1-p)2^{2m+1-p}\binom{p}{m} \\
    &amp;=2^{2m+1}\sum_{p=m}^{2m}(2m+1-p)2^{-p}\binom{p}{m} \\
    &amp;= 2^{2m+1}\left[(2m+1)-(2m+1)+\frac{m+1}{2^{2m+1}}\binom{2m+2}{m+1}\right] \\
    &amp;= (m+1)\binom{2m+2}{m+1}\\
    &amp;= n\binom{2n}{n}
\end{aligned}
\]</span> 整个证明神乎其技，学不来学不来，感觉自己实在是太菜了。</p>
<h1 id="生成函数证明">生成函数证明</h1>
<p>帖子里有，看起来非常短，我对于生成函数还不熟练，积极学习中~TODO: 看懂了整理上来。</p>
<h1 id="组合证明">组合证明</h1>
<p>帖子里有，看起来非常不短，似乎用了很多non-trivial的论证方法，试图理解中~TODO: 看懂了整理上来。</p>
<h1 id="超几何证明">超几何证明</h1>
<p>这个证明是我在翻《基础数学》看到超几何函数那一节的时候想的，是这四个证明中唯一一个我原创的证明（悲）。用到了超几何函数，蒟蒻高中生感觉非常炫酷.jpg</p>
<p>首先把等式左边改成无限求和： <span class="math display">\[
\begin{aligned}
\sum_{k=1}^{n}k2^k\binom{2n-d-1}{n-1} &amp;= \sum_{k=1}^{n}k2^k\binom{2n-k-1}{n-k} \\
&amp;= \sum_{k=1}^{\infty}k2^k\binom{2n-k-1}{n-k} \\
&amp;= \sum_{k=0}^{\infty}(k+1)2^{k+1}\binom{2n-k-2}{n-k-1}
\end{aligned}
\]</span> 若令<span class="math inline">\(t_k=(k+1)2^{k+1}\binom{2n-k-2}{n-k-1}\)</span>，则观察到： <span class="math display">\[
\begin{aligned}
\frac{t_{k+1}}{t_k} &amp;= \frac{(k+2)2^{k+2}\binom{2n-k-3}{n-k-2}}{(k+1)2^{k+1}\binom{2n-k-2}{n-k-1}} \\
&amp;= \frac{2(k+2)[k+(1-n)]}{(k+1)[k+(2-2n)]} \\
\end{aligned}
\]</span> 是一个关于<span class="math inline">\(k\)</span>的有理式，因此引入高斯超几何函数： <span class="math display">\[
\begin{aligned}
\mathrm{LHS} &amp;=t_0\cdot {}_2F_1(2,1-n;2-2n;2)\\
&amp;=2\binom{2n-2}{n-1} {}_2F_1(2,1-n;2-2n;2)
\end{aligned}
\]</span> 考虑化简超几何项，利用如下Kummer二次变换（他1836年论文的Eq.54）： <span class="math display">\[
{}_2F_1(a,b;2b;z)=\frac{1}{(1-z)^{a/2}}{}_2F_1\left(\frac{1}{2}a,b-\frac{1}{2}a;b+\frac{1}{2};\frac{z^2}{4z-4}\right)
\]</span> 则得到： <span class="math display">\[
{}_2F_1(2,1-n;2-2n;2)=-{}_2F_1(1,-n;\frac{3}{2}-n;1)
\]</span> 因为都是实参数且<span class="math inline">\(1-n&lt;\frac{3}{2}-n\)</span>，因此运用高斯定理： <span class="math display">\[
\begin{aligned}
{}_2F_1(1,-n;\frac{3}{2}-n;1) &amp;= \frac{\Gamma\left(\frac{3}{2}-n\right)\Gamma\left(\frac{1}{2}\right)}{\Gamma\left(\frac{1}{2}-n\right)\Gamma\left(\frac{3}{2}\right)} \\
&amp;= 2\left(\frac{1}{2}-n\right) \\
&amp;= 1-2n
\end{aligned}
\]</span> 一路代回去： <span class="math display">\[
\begin{aligned}
\mathrm{LHS} &amp;= 2\binom{2n-2}{n-1} {}_2F_1(2,1-n;2-2n;2) \\
&amp;= 2(2n-1)\binom{2n-2}{n-1} \\
&amp;= 2n\binom{2n-1}{n-1} \\
&amp;= n\binom{2n}{n} = \mathrm{RHS}
\end{aligned}
\]</span> 证毕。</p>
<p>整个证明过程颇有一种高射炮打蚊子的既视感。超几何函数各种公式一大堆还千奇百怪，套就完事了，然而无论是Kummer的二次变换还是高斯定理我都不知道怎么证（悲）。 我已经把Ahlfors的Complex Analysis存起来了，决定有空看看（不知道会不会有这方面的内容）。</p>
<p>嘛，在初等证明存在的情况下，用这种严重超纲的做法只能给人一种装逼的错觉<del>虽然我感觉有点开心？</del>，别人看你搞不好都跟关爱智障一样。MSE上果然大佬太多，向大佬低头.jpg。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://alan20210202.github.io/2021/07/25/%E7%BA%BF%E6%80%A7%E9%80%86%E5%85%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/avatar.png">
      <meta itemprop="name" content="Chengyuan Ma">
      <meta itemprop="description" content="不务正业高中生一枚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chengyuan Ma's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/25/%E7%BA%BF%E6%80%A7%E9%80%86%E5%85%83/" class="post-title-link" itemprop="url">线性递推逆元</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-25 03:11:41" itemprop="dateCreated datePublished" datetime="2021-07-25T03:11:41-04:00">2021-07-25</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-11-02 22:36:32" itemprop="dateModified" datetime="2018-11-02T22:36:32-04:00">2018-11-02</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><del>其实这个并没有什么卵用，基本没有人会卡。</del></p>
<p>对于求单个数的逆元我们有<span class="math inline">\(O(\log n)\)</span>的算法，因此，如果我们要求<span class="math inline">\([1, n]\)</span>的所有数的逆元的话，朴素的做法是可以做到<span class="math inline">\(O(n\log n)\)</span>的，但是其实我们有线性递推的算法，假设我们要求<span class="math inline">\(i\)</span>在模<span class="math inline">\(P\)</span>意义下的逆元，且<span class="math inline">\([1, i - 1]\)</span>的逆元已经求出：</p>
<p>设<span class="math inline">\(P = ki + r\)</span>，其中<span class="math inline">\(k = \left\lfloor \frac{P}{i} \right\rfloor, r = P \bmod i &lt; i\)</span>，我们有： <span class="math display">\[
ki + r \equiv 0 \pmod{P}
\]</span> 两边同时乘上<span class="math inline">\(i^{-1}r^{-1}\)</span>： <span class="math display">\[
\begin{aligned}
kr^{-1} + i^{-1} &amp;\equiv 0 &amp;\pmod{P} \\
i^{-1} &amp;\equiv -kr^{-1} &amp;\pmod{P} \\
i^{-1} &amp;\equiv -\left\lfloor\frac{P}{i}\right\rfloor (P \bmod i)^{-1} &amp;\pmod{P}
\end{aligned}
\]</span> 由于我们之前已经求得了<span class="math inline">\(P \bmod i\)</span>的逆元，<span class="math inline">\(i\)</span>的逆元依上式可以直接递推，代码也很短：</p>
<pre class="line-numbers"><code class="language-cpp">inv[1] = 1;
for (int i = 2; i &lt;= n; i++)
    inv[i] = (-(P / i) * inv[P % i] % P + P) % P;</code></pre>
<p><del>但是真的没有卵用啊，<span class="math inline">\(P\)</span>动不动就是<span class="math inline">\(998244353\)</span>或者<span class="math inline">\(1 \times 10^9 + 7\)</span>这种，就算你能线性递推时间和空间也要炸糊的。</del></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://alan20210202.github.io/2021/07/25/%E7%BA%BF%E6%80%A7%E5%9F%BA%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/avatar.png">
      <meta itemprop="name" content="Chengyuan Ma">
      <meta itemprop="description" content="不务正业高中生一枚">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Chengyuan Ma's Blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/07/25/%E7%BA%BF%E6%80%A7%E5%9F%BA%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">异或 线性基</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-07-25 03:11:41" itemprop="dateCreated datePublished" datetime="2021-07-25T03:11:41-04:00">2021-07-25</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2018-09-04 21:43:02" itemprop="dateModified" datetime="2018-09-04T21:43:02-04:00">2018-09-04</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="线性基">线性基</h1>
<p><strong>定义：</strong>给定一组向量，构成一个线性空间，如果我们能够找到一组<strong>线性无关的向量</strong>，使得这些向量的线性组合能够构成整个线性空间，则这一组向量成为该向量空间的<strong>线性基</strong>。</p>
<p><strong>算法：</strong>计算线性基我们可以把一组向量排成矩阵，然后在矩阵上跑高斯消元法，消出来的非零行向量即为线性基，非零行向量数目为矩阵的行秩。</p>
<p>以下给出对于常规线性基的高斯消元代码：</p>
<pre class="line-numbers"><code class="language-cpp">void gauss() &#123;
    int dim = 0; // 行秩
    for (int i = 1; i &lt;= n; i++) &#123;
        int piv = dim + 1;
        for (int j = dim + 1; j &lt;= m; j++)
            if (abs(a[j][i]) &gt; abs(a[piv][i]))
                piv = j;
        if (abs(a[piv][i]) &lt; EPS) continue; // 自由元
        dim++;
        for (int j = 1; j &lt;= n; j++)
            swap(a[dim][j], a[piv][j]);
        for (int j = 1; j &lt;= m; j++) &#123;
            if (j == dim) continue;
            if (abs(a[j][i]) &lt; EPS) continue;
            double r = a[j][i] / a[dim][i];
            for (int k = 1; k &lt;= n; k++)
                a[j][k] -= r * a[dim][k];
        &#125;
    &#125;
&#125;</code></pre>
<h1 id="异或">异或</h1>
<p>简称XOR，数学记号为$$，C++中为<code>^</code>，<strong>异或本质上是在模<span class="math inline">\(2\)</span>意义下的加法运算。</strong>因此线性代数的很多算法也可以应用到异或这样的有限域上，异或的一个很重要的性质是<strong>相消性</strong>，即一个数异或两次等于没异或！（等同于乘<span class="math inline">\(2\)</span>，在模<span class="math inline">\(2\)</span>下就肯定没意义啦）。</p>
<p>异或的相消性很重要的一个应用是在图上使用DFS计算环上边的异或，我们只需要计算从DFS树根节点出发各个点到根上路径的异或和（记作<span class="math inline">\(dis(u)\)</span>）。如果我们在DFS上找到返祖边<span class="math inline">\(e = (u, v)\)</span>，环的异或就是<span class="math inline">\(dis(u) \oplus dis(v) \oplus w(e)\)</span>。我们可以看到这个运算中<span class="math inline">\(u, v\)</span>LCA以上的部分都被抵消掉了，因此最后得到的就是整个环的异或和。<strong>如果求图上路径异或和的话我们可以用这样的方法搞出神奇的效果</strong>。</p>
<h1 id="异或线性基">异或线性基</h1>
<p>如何求出异或意义下的线性基呢？朴素的高斯消元肯定是可以的，但是对于异或我们首先可以压位减少常数，然后对于异或线性基我们还有一种求法，对于一个数<span class="math inline">\(x\)</span>，我们可以这样把<span class="math inline">\(x\)</span><strong>插入</strong>一组线性基：</p>
<ol type="1">
<li>找到<span class="math inline">\(x\)</span>的最高二进制位，记作<span class="math inline">\(i\)</span>。</li>
<li>查看第<span class="math inline">\(i\)</span>位的线性基<span class="math inline">\(p[i]\)</span>是否被插入。</li>
<li>如果没有被插入，插入第<span class="math inline">\(i\)</span>位的线性基，结束。</li>
<li>如果已经被插入了，令<span class="math inline">\(x = x \oplus p[i]\)</span>。</li>
</ol>
<p><strong>正确性证明：</strong>如果当前位没被插入则插入操作显然正确，如果被插入，则<span class="math inline">\(x \oplus p[i]\)</span>不仅消除了第<span class="math inline">\(i\)</span>位，同时可以证明如果<span class="math inline">\(x \oplus p[i]\)</span>可以被线性基表出，则<span class="math inline">\(x\)</span>一定也可以被线性基表出。</p>
<p>一个二进制数在被插入线性基的过程中如果失败了，那么它就会变成<span class="math inline">\(0\)</span>，暗示它可以由我们现有的线性基表出。</p>
<p>代码：</p>
<pre class="line-numbers"><code class="language-cpp">bool insert(int x) &#123;
    for (int i = 30; i &gt;= 0; i--) &#123; // 最高位数
        if ((x &gt;&gt; i) &amp; 1) &#123;
            if (!p[i]) &#123;
                p[i] = x;
                return true;
            &#125; else
                x ^= p[i];
        &#125;
    &#125;
    return false;
&#125;</code></pre>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>


<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Chengyuan Ma</span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js" integrity="sha512-YBk7HhgDZvBxmtOfUdvX0z8IH2d10Hp3aEygaMNhtF8fSOvBZ16D/1bXZTJV6ndk/L/DlXxYStP8jrF77v2MIg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/plugins/line-numbers/prism-line-numbers.min.js" integrity="sha512-br8H6OngKoLht57WKRU5jz3Vr0vF+Tw4G6yhNN2F3dSDheq4JiaasROPJB1wy7PxPk7kV/+5AIbmoZLxxx7Zow==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-bash.min.js" integrity="sha512-JvRd44DHaJAv/o3wxi/dxhz2TO/jwwX8V5/LTr3gj6QMQ6qNNGXk/psoingLDuc5yZmccOq7XhpVaelIZE4tsQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-c.min.js" integrity="sha512-T6Lco61aWqCKSznWkd38lf159pD0+EwZ9UCEv6ARAvaWFiy/UHtYgOmlasT8lq5Ck17ZNHzbe5eHUablTGRXxw==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-cmake.min.js" integrity="sha512-M99z3be36IUB5pA3DWoJvjSYaZA9BiUqf1jXzVcjntASBZFNI53oDRzdJqGzH5voybcAx5Sg8F5QyryE6afD3g==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-cpp.min.js" integrity="sha512-hxZJ6OUEpUl9/o4C1gMGvrAbeqDaldBiZbs08c/V8NcU7YImBFlqJAc7Uzjf3bh2W8Wx26/dVDyPk9cUMQY0Mw==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-go.min.js" integrity="sha512-SgF1uayJ2/8TV+MhLasqygnm++vYRXswmrR2ZAmUCL4pXtf+6KzUgXPpn10Y6xca658sxOQEOsoP3MChfhke5A==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-java.min.js" integrity="sha512-PWHY6Vao4E9K4LsGBYCY0ttDeiWZwuUozTbJvSy9UFHRz2J4Bl7rcWML3wEnJTVuCJhSwGne/8My5gTo/gnbpg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-json.min.js" integrity="sha512-IC7rV8RslChgByOdUFC6ePqOGn+OwJhnKC3S5AezM8DAiOdGhJMwgsIvBChsa2yuxxoPbH2+W/kjNUM1cc+jUQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-kotlin.min.js" integrity="sha512-aTozTdtORp/xxS/dhRRDfmv/p1eyEMTje96MplkSOqdbKGGvOYIlogoGdtsh/BD91vaqKoAw9M7O/DodqqudIQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-julia.min.js" integrity="sha512-eTGeKQdDzC2rPAUVfM2Fa36s9B9wp138NEhzZqJpRSdJQ66BwLUot25r2YQveCRU5uYNVfX3gckDkl4byfBIWw==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-latex.min.js" integrity="sha512-6D3l3Fy8g/hr6AeK2g1rcVZHyFjCqiqgUrwy0mBZTGFd8UwVcUDhzQeIIv3eYeXDecGPTtBOS9ctyRzJyUgypQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-rust.min.js" integrity="sha512-kgT7r2HlCEO4b+Rp3nJvm+/EMBwGMvv1WMdWkb3eNgnS91llMli8Y3T1CgnD8Hifqx50Q3XLUQXDd7PzKQQtUA==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-python.min.js" integrity="sha512-wK9tQmDrstGtZqTKcyVf3h457QGMlNriKs+fHmEkiCizrq0LVovfT3v1smeT1DlQetHhdRkkX1JSuZg5LoNHJg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-nginx.min.js" integrity="sha512-/MNzg8GlnVrAau/TZClh1jxgHNX0HDgidbGnHS5x1OtbKiNoK3e0XNd1oV16xmmeDHjisa3GKLArUau+43GZ4A==" crossorigin="anonymous"></script>
<script type = "text/javascript">
    document.addEventListener('pjax:complete', function() {
        if (typeof Prism !== 'undefined') {
            Prism.highlightAll();
        }
    });
</script>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@next-theme/pjax@0.4.0/pjax.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pangu@4.0.7/dist/browser/pangu.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script><script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '.page-configurations',
    '.main-inner',
    '.post-toc-wrap',
    '.languages',
    '.pjax'
  ],
  analytics: false,
  cacheBust: false,
  scrollRestoration: false,
  scrollTo: !CONFIG.bookmark.enable
});

document.addEventListener('pjax:success', () => {
  pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  const hasTOC = document.querySelector('.post-toc');
  document.querySelector('.sidebar-inner').classList.toggle('sidebar-nav-active', hasTOC);
  document.querySelector(hasTOC ? '.sidebar-nav-toc' : '.sidebar-nav-overview').click();
  NexT.utils.updateSidebarPosition();
});
</script>


  






  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



    <div class="pjax">

  <script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'none'
      },
      options: {
        renderActions: {
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              const target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    const script = document.createElement('script');
    script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3.1.2/es5/tex-mml-chtml.js';
    script.defer = true;
    document.head.appendChild(script);
  } else {
    MathJax.startup.document.state(0);
    MathJax.typesetClear();
    MathJax.texReset();
    MathJax.typeset();
  }
</script>



    </div>
</body>
</html>
